# DrowsyDetect 疲劳检测系统需求分析说明书

## 1. 项目概述

### 1.1 项目名称
DrowsyDetect - 基于计算机视觉的实时疲劳检测系统

### 1.2 项目背景
随着现代生活节奏的加快，疲劳驾驶、工作疲劳等问题日益突出，给人身安全带来严重威胁。本项目旨在开发一个基于Web技术的实时疲劳检测系统，通过分析用户的眼部状态来判断疲劳程度，及时发出预警。

### 1.3 项目目标
- 实现基于摄像头的实时人脸检测和眼部状态分析
- 提供准确的疲劳状态判断和预警功能
- 构建用户友好的Web界面，支持参数调节
- 确保系统的实时性和稳定性

## 2. 功能需求分析

### 2.1 核心功能需求

#### 2.1.1 摄像头管理功能
**需求描述：** 系统需要能够访问和管理用户的摄像头设备
- **FR-001** 摄像头权限获取：系统应能请求并获取用户摄像头访问权限
- **FR-002** 多摄像头支持：系统应支持检测和选择多个摄像头设备
- **FR-003** 摄像头启停控制：提供启动和停止摄像头的控制功能
- **FR-004** 视频流显示：实时显示摄像头捕获的视频流

#### 2.1.2 人脸检测与关键点识别
**需求描述：** 基于MediaPipe技术实现人脸检测和面部关键点识别
- **FR-005** 实时人脸检测：系统应能实时检测视频流中的人脸
- **FR-006** 面部关键点提取：提取468个面部关键点，特别是眼部区域关键点
- **FR-007** 检测置信度控制：支持调节人脸检测的置信度阈值
- **FR-008** 关键点可视化：可选择性地在视频上叠加显示关键点

#### 2.1.3 疲劳状态分析
**需求描述：** 通过眼睛纵横比(EAR)算法分析用户的疲劳状态
- **FR-009** EAR计算：计算左右眼的眼睛纵横比并取平均值
- **FR-010** 疲劳阈值判断：当EAR值低于设定阈值时判定为闭眼状态
- **FR-011** 连续帧数统计：统计连续闭眼的帧数
- **FR-012** 疲劳预警：当连续闭眼帧数达到阈值时触发疲劳预警

#### 2.1.4 参数配置功能
**需求描述：** 提供可调节的参数以适应不同用户和环境
- **FR-013** 置信阈值调节：支持调节人脸检测和追踪的置信度(0-1)
- **FR-014** 疲劳阈值调节：支持调节EAR疲劳判定阈值(0.1-0.5)
- **FR-015** 持续帧数调节：支持调节触发预警所需的连续闭眼帧数(1-60)
- **FR-016** 实时参数更新：参数调节应实时生效

#### 2.1.5 状态监控与反馈
**需求描述：** 提供系统运行状态的实时监控和用户反馈
- **FR-017** 系统状态显示：显示摄像头、模型加载、检测等状态
- **FR-018** 性能指标显示：显示FPS、EAR值等实时性能指标
- **FR-019** 检测结果显示：显示当前是否检测到人脸
- **FR-020** 视觉预警：通过界面元素提供疲劳预警提示

### 2.2 辅助功能需求

#### 2.2.1 错误处理与恢复
- **FR-021** 模型加载失败处理：当MediaPipe模型加载失败时提供重试功能
- **FR-022** 摄像头访问失败处理：提供摄像头访问失败的回退方案
- **FR-023** 网络连接异常处理：处理CDN资源加载失败的情况

#### 2.2.2 用户体验优化
- **FR-024** 响应式设计：界面应适配不同屏幕尺寸
- **FR-025** 操作反馈：所有用户操作应有明确的视觉反馈
- **FR-026** 帮助文档：提供使用说明和帮助信息

## 3. 非功能需求分析

### 3.1 性能需求
- **NFR-001** 实时性：系统应保持至少15FPS的处理速度
- **NFR-002** 响应时间：用户操作响应时间不超过100ms
- **NFR-003** 内存使用：浏览器内存占用应控制在合理范围内
- **NFR-004** CPU使用率：避免过度占用CPU资源影响系统性能

### 3.2 可靠性需求
- **NFR-005** 稳定性：系统应能连续运行而不出现崩溃
- **NFR-006** 错误恢复：系统应能从各种异常状态中自动恢复
- **NFR-007** 数据准确性：疲劳检测的准确率应达到可接受水平

### 3.3 可用性需求
- **NFR-008** 易用性：界面应直观易用，无需专业知识
- **NFR-009** 可访问性：支持键盘导航和屏幕阅读器
- **NFR-010** 多语言：当前支持中文界面

### 3.4 兼容性需求
- **NFR-011** 浏览器兼容：支持主流现代浏览器(Chrome、Firefox、Safari、Edge)
- **NFR-012** 操作系统兼容：支持Windows、macOS、Linux等主流操作系统
- **NFR-013** 设备兼容：支持笔记本电脑、台式机等设备的摄像头

### 3.5 安全性需求
- **NFR-014** 隐私保护：视频数据仅在本地处理，不上传到服务器
- **NFR-015** 权限控制：严格控制摄像头访问权限
- **NFR-016** 数据安全：确保用户数据不被恶意获取

## 4. 技术需求分析

### 4.1 技术架构
- **前端技术栈：** HTML5、CSS3、JavaScript (ES6+)
- **计算机视觉：** MediaPipe FaceMesh
- **视频处理：** WebRTC getUserMedia API
- **部署方式：** 静态Web应用，支持本地文件和HTTP服务器

### 4.2 核心算法
- **人脸检测：** MediaPipe FaceMesh 468点面部关键点检测
- **疲劳检测：** 基于眼睛纵横比(EAR)的疲劳状态判断算法
- **数据处理：** 实时视频流处理和关键点坐标计算

### 4.3 外部依赖
- **MediaPipe库：** @mediapipe/face_mesh、@mediapipe/camera_utils、@mediapipe/drawing_utils
- **CDN服务：** jsdelivr.net提供的MediaPipe资源
- **浏览器API：** getUserMedia、Canvas API、requestAnimationFrame

## 5. 系统约束

### 5.1 环境约束
- **网络环境：** 需要网络连接以加载MediaPipe模型（首次加载）
- **硬件要求：** 需要具备摄像头的设备
- **浏览器要求：** 支持WebRTC和Canvas API的现代浏览器

### 5.2 使用约束
- **光照条件：** 需要充足且均匀的光照环境
- **用户姿态：** 建议用户保持正脸朝向摄像头
- **距离要求：** 用户与摄像头保持适当距离以确保人脸完整可见

### 5.3 技术约束
- **实时处理：** 受设备性能限制，处理速度可能因设备而异
- **模型精度：** 检测精度受MediaPipe模型本身限制
- **浏览器安全策略：** 受浏览器同源策略和权限控制限制

## 6. 用户角色与使用场景

### 6.1 目标用户
- **个人用户：** 需要疲劳监控的个人（如长时间工作者、学习者）
- **开发者：** 需要集成疲劳检测功能的应用开发者
- **研究人员：** 进行疲劳检测相关研究的学者

### 6.2 主要使用场景
- **办公环境：** 长时间电脑工作时的疲劳监控
- **学习场景：** 在线学习或阅读时的状态监控
- **驾驶模拟：** 驾驶训练或模拟器中的疲劳检测
- **研究实验：** 疲劳相关的科学研究实验

## 7. 验收标准

### 7.1 功能验收标准
- 系统能够成功启动摄像头并显示视频流
- 能够准确检测人脸并提取关键点
- EAR值计算准确，疲劳预警功能正常
- 所有参数调节功能正常工作
- 错误处理和恢复机制有效

### 7.2 性能验收标准
- 视频处理帧率不低于15FPS
- 用户界面响应时间不超过100ms
- 系统能够稳定运行30分钟以上
- 内存使用量保持在合理范围

### 7.3 兼容性验收标准
- 在Chrome、Firefox、Safari、Edge浏览器中正常运行
- 支持1920x1080及以上分辨率显示
- 在Windows、macOS、Linux系统中正常工作

## 8. 风险分析

### 8.1 技术风险
- **CDN依赖风险：** MediaPipe资源加载失败可能导致系统无法正常工作
- **浏览器兼容性风险：** 新版本浏览器可能改变API行为
- **性能风险：** 低性能设备可能无法达到实时处理要求

### 8.2 用户体验风险
- **环境适应性：** 不同光照和角度条件下检测精度可能下降
- **误报风险：** 可能出现疲劳误判或漏判情况
- **隐私担忧：** 用户可能对摄像头使用存在隐私顾虑

### 8.3 缓解措施
- 提供离线模式和本地资源备份
- 实施全面的浏览器兼容性测试
- 优化算法性能，提供性能调节选项
- 提供详细的使用指导和隐私说明

## 9. 项目交付物

### 9.1 核心文件
- `index.html` - 主界面文件
- `main.js` - 核心逻辑实现
- `styles.css` - 样式定义文件
- `README.md` - 项目说明文档

### 9.2 文档交付物
- 需求分析说明书（本文档）
- 用户使用手册
- 技术实现文档
- 测试报告

## 10. 总结

DrowsyDetect项目是一个基于Web技术的实时疲劳检测系统，通过MediaPipe FaceMesh技术实现人脸关键点检测，并基于眼睛纵横比(EAR)算法进行疲劳状态判断。系统具有实时性强、易于使用、隐私保护等特点，适用于个人疲劳监控、研究实验等多种场景。

项目采用纯前端技术实现，无需后端服务器，降低了部署复杂度。通过合理的参数配置和用户界面设计，系统能够适应不同用户的需求和使用环境。

本需求分析说明书为项目的进一步开发、测试和维护提供了全面的指导，确保项目能够满足用户需求并达到预期的质量标准。
